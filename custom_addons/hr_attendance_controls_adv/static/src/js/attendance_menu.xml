<?xml version="1.0" encoding="UTF-8"?>
<template>
    <t t-inherit="hr_attendance.attendance_menu" t-inherit-mode="extension">
        
        <!-- ğŸ¯ PASO 7: Personalizar botÃ³n del systray segÃºn attendance_status -->
        <xpath expr="//button[i[contains(@class, 'fa-circle')]]" position="replace">
            <button type="button"
                    class="btn btn-sm o_attendance_systray_button o-dropdown dropdown-toggle dropdown"
                    aria-expanded="false">
                
                <!-- ğŸ”´ Pre-work: Sin registro - Ã­cono rojo X -->
                <i t-if="this.state.attendance_status === 'pre_work'" 
                   class="fa fa-times-circle text-danger me-1" style="margin-top: 1px;"/>
                
                <!-- ğŸŸ¡ In-work: En jornada - Ã­cono amarillo play -->
                <i t-if="this.state.attendance_status === 'in_work'" 
                   class="fa fa-play-circle text-warning me-1" style="margin-top: 1px;"/>
                
                <!-- ğŸŸ¢ Post-work: Completado - Ã­cono verde check -->
                <i t-if="this.state.attendance_status === 'post_work'" 
                   class="fa fa-check-circle text-success me-1" style="margin-top: 1px;"/>
                
                <!-- ğŸ”˜ Fallback: Estado desconocido - Ã­cono original -->
                <i t-if="!this.state.attendance_status" 
                   class="fa fa-circle-o me-1"/>
                
                Asistencia
            </button>
        </xpath>
        
        <!-- ğŸ”§ AGREGAR EVENTO onOpened AL DROPDOWN -->
        <xpath expr="//Dropdown" position="attributes">
            <attribute name="onOpened.bind">onOpenedContent</attribute>
        </xpath>
        
        <!-- ğŸ”„ REEMPLAZAR COMPLETAMENTE EL CONTENIDO DEL SLOT -->
        <xpath expr="//t[@t-set-slot='content']" position="replace">
            <t t-set-slot="content">
                <!-- ğŸ”„ SPINNER DE CARGA -->
                <div t-if="this.state.show_check_inout_button === false" class="o_att_menu_container_spinner text-center">
                    <i class="fa fa-circle-o-notch fa-spin spinner"></i>
                </div>
                
                <!-- ğŸ¯ PASO 8: CONTENIDO BASADO EN ATTENDANCE_STATUS -->
                <div t-if="this.state.show_check_inout_button" class="o_att_menu_container d-flex flex-column gap-3">
                    
                    <!-- ğŸŒ… VISTA PRE_WORK: Antes del primer check-in -->
                    <div t-if="this.state.attendance_status === 'pre_work'"
                         class="p-3 mb-3 rounded bg-light border">
                        <h5 class="mb-2 text-primary">
                            <i class="fa fa-sun-o me-2"/>
                            Â¡Bienvenido! ğŸ‘‹
                        </h5>
                        <p class="mb-3 text-muted">
                            TodavÃ­a no has iniciado tu jornada laboral.  
                            Pulsa el botÃ³n para hacer tu <strong>check-in</strong> ğŸ˜‰
                        </p>

                        <button t-on-click="() => this.signInOut()"
                                class="btn btn-success w-100">
                            <i class="fa fa-sign-in me-2"/> 
                            Iniciar Jornada
                        </button>
                    </div>

                    <!-- ğŸ”§ DEBUG: Mostrar estado actual -->
                    <div class="p-2 bg-info text-white rounded small">
                        ğŸ” Debug: attendance_status = <strong t-esc="this.state.attendance_status"/>
                    </div>
                    
                </div>
            </t>
        </xpath>
    </t>
</template>